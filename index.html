<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find a Verse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;700&family=Source+Code+Pro:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        /* --- Themes --- */
        /* The body background color will now be controlled by these theme classes */
        .theme-light {
            background-color: #f3f4f6;
            color: #1f2937;
        }
        /* Main container background color for each theme */
        .theme-light #main-container { background-color: #ffffff; }
        .theme-light .text-gray-800 { color: #1f2937; }
        .theme-light .text-gray-500 { color: #6b7280; }
        .theme-light .bg-gray-100 { background-color: #f9fafb; }
        .theme-light input, .theme-light textarea { background-color: #ffffff; border-color: #d1d5db; color: #1f2937; }
        .theme-light input::placeholder, .theme-light textarea::placeholder { color: #9ca3af; }
        .theme-light .border-gray-300 { border-color: #d1d5db; }
        .theme-light .shadow-md { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1-px rgba(0, 0, 0, 0.06); }
        
        .theme-dark {
            background-color: #1a202c;
            color: #e2e8f0;
        }
        /* Main container background color for each theme */
        .theme-dark #main-container { background-color: #2d3748; }
        .theme-dark .bg-gray-100 { background-color: #4a5568; }
        .theme-dark .text-gray-800 { color: #e2e8f0; }
        .theme-dark .text-gray-500 { color: #a0aec0; }
        .theme-dark input, .theme-dark textarea { background-color: #4a5568; border-color: #4a5568; color: #e2e8f0; }
        .theme-dark input::placeholder, .theme-dark textarea::placeholder { color: #a0aec0; }
        .theme-dark .border-gray-300 { border-color: #4a5568; }
        .theme-dark .shadow-md { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.12); }
        .theme-dark #random-verse-button {
            background-color: #4a5568;
            color: #e2e8f0;
        }
        .theme-dark #random-verse-button:hover {
            background-color: #617d98;
        }
        
        .theme-ocean {
            background-color: #2b6cb0;
            color: #e2e8f0;
        }
        /* Main container background color for each theme */
        .theme-ocean #main-container { background-color: #1c4b7c; }
        .theme-ocean .bg-gray-100 { background-color: #3182ce; }
        .theme-ocean .text-gray-800 { color: #e2e8f0; }
        .theme-ocean .text-gray-500 { color: #bbd0e8; }
        .theme-ocean input, .theme-ocean textarea { background-color: #3182ce; border-color: #4a90e2; color: #e2e8f0; }
        .theme-ocean input::placeholder, .theme-ocean textarea::placeholder { color: #bbd0e8; }
        .theme-ocean .border-gray-300 { border-color: #4a90e2; }
        .theme-ocean .shadow-md { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .theme-ocean .bg-blue-600 { background-color: #1d4ed8; }
        .theme-ocean #random-verse-button {
            background-color: #3182ce;
            color: #e2e8f0;
        }
        .theme-ocean #random-verse-button:hover {
            background-color: #63b3ed;
        }

        .theme-forest-green {
            background-color: #1F382A;
            color: #e2f0e6;
        }
        /* Main container background color for each theme */
        .theme-forest-green #main-container { background-color: #2F523B; }
        .theme-forest-green .bg-gray-100 { background-color: #3D6C4F; }
        .theme-forest-green .text-gray-800 { color: #e2f0e6; }
        .theme-forest-green .text-gray-500 { color: #B1D2BE; }
        .theme-forest-green .bg-blue-600 { background-color: #38a169; }
        .theme-forest-green .text-blue-600 { color: #68D391; }
        .theme-forest-green #random-verse-button {
            background-color: #38a169;
            color: #e2f0e6;
        }
        .theme-forest-green #random-verse-button:hover {
            background-color: #2f855a;
        }
        
        .theme-dusk {
            background-color: #2c3e50;
            color: #ecf0f1;
        }
        .theme-dusk #main-container { background-color: #34495e; }
        .theme-dusk .bg-gray-100 { background-color: #2980b9; }
        .theme-dusk .text-gray-800 { color: #ecf0f1; }
        .theme-dusk .text-gray-500 { color: #bdc3c7; }
        .theme-dusk input, .theme-dusk textarea { background-color: #34495e; border-color: #34495e; color: #ecf0f1; }
        .theme-dusk input::placeholder, .theme-dusk textarea::placeholder { color: #bdc3c7; }
        .theme-dusk .border-gray-300 { border-color: #34495e; }
        .theme-dusk .shadow-md { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.12); }
        .theme-dusk #random-verse-button {
            background-color: #2980b9;
            color: #ecf0f1;
        }
        .theme-dusk #random-verse-button:hover {
            background-color: #3498db;
        }

        .verse-card:hover {
            transform: scale(1.03);
        }

        /* --- Custom Animations --- */
        /* Animation for the verse result container and favorite cards */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        /* Animation for the main container on page load */
        @keyframes popIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        .pop-in {
            animation: popIn 0.5s ease-out forwards;
        }

        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .copied-message {
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4 transition-colors duration-300 theme-light">
    <!-- Main Container with pop-in animation -->
    <div id="main-container" class="w-full max-w-2xl rounded-2xl shadow-xl p-8 space-y-8 transition-colors duration-300 pop-in">
        <!-- Header -->
        <header class="text-center space-y-2">
            <h1 class="text-5xl font-extrabold text-blue-600">Find a Verse</h1>
            <p class="text-gray-500">Get a verse that speaks to your heart.</p>
             <p id="user-id-display" class="text-xs text-gray-400 mt-2"></p>
        </header>

        <!-- The Verse of the Day Section -->
        <section class="border-t border-gray-300 pt-6 space-y-4">
            <h2 class="text-xl font-bold text-gray-800">Verse of the Hour</h2>
            <div id="verse-of-day" class="p-6 bg-blue-500 text-white rounded-2xl shadow-md space-y-2 text-center transition-transform duration-300">
                <div id="votd-text" class="text-lg font-medium italic"></div>
                <div id="votd-reference" class="text-sm font-semibold"></div>
            </div>
        </section>

        <!-- Mood-Based Verses Section -->
        <section class="border-t border-gray-300 pt-6 space-y-4">
            <h2 class="text-xl font-bold text-gray-800">Find a Verse by Emotion</h2>
            <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                <button data-emotion="joy" class="verse-card bg-green-400 text-white p-6 rounded-xl shadow-md font-bold text-center transition-all duration-200 ease-in-out hover:-translate-y-1 hover:shadow-lg active:translate-y-0 active:shadow-md">Joy</button>
                <button data-emotion="peace" class="verse-card bg-purple-400 text-white p-6 rounded-xl shadow-md font-bold text-center transition-all duration-200 ease-in-out hover:-translate-y-1 hover:shadow-lg active:translate-y-0 active:shadow-md">Peace</button>
                <button data-emotion="sadness" class="verse-card bg-blue-400 text-white p-6 rounded-xl shadow-md font-bold text-center transition-all duration-200 ease-in-out hover:-translate-y-1 hover:shadow-lg active:translate-y-0 active:shadow-md">Sadness</button>
                <button data-emotion="fear" class="verse-card bg-orange-400 text-white p-6 rounded-xl shadow-md font-bold text-center transition-all duration-200 ease-in-out hover:-translate-y-1 hover:shadow-lg active:translate-y-0 active:shadow-md">Fear</button>
                <button data-emotion="anger" class="verse-card bg-red-400 text-white p-6 rounded-xl shadow-md font-bold text-center transition-all duration-200 ease-in-out hover:-translate-y-1 hover:shadow-lg active:translate-y-0 active:shadow-md">Anger</button>
                <button data-emotion="strength" class="verse-card bg-indigo-400 text-white p-6 rounded-xl shadow-md font-bold text-center transition-all duration-200 ease-in-out hover:-translate-y-1 hover:shadow-lg active:translate-y-0 active:shadow-md">Strength</button>
                <button data-emotion="hope" class="verse-card bg-amber-500 text-white p-6 rounded-xl shadow-md font-bold text-center transition-all duration-200 ease-in-out hover:-translate-y-1 hover:shadow-lg active:translate-y-0 active:shadow-md">Hope</button>
                <button data-emotion="gratitude" class="verse-card bg-pink-400 text-white p-6 rounded-xl shadow-md font-bold text-center transition-all duration-200 ease-in-out hover:-translate-y-1 hover:shadow-lg active:translate-y-0 active:shadow-md">Gratitude</button>
                <button data-emotion="healing" class="verse-card bg-teal-400 text-white p-6 rounded-xl shadow-md font-bold text-center transition-all duration-200 ease-in-out hover:-translate-y-1 hover:shadow-lg active:translate-y-0 active:shadow-md">Healing</button>
                <button data-emotion="patience" class="verse-card bg-cyan-500 text-white p-6 rounded-xl shadow-md font-bold text-center transition-all duration-200 ease-in-out hover:-translate-y-1 hover:shadow-lg active:translate-y-0 active:shadow-md">Patience</button>
                <button data-emotion="forgiveness" class="verse-card bg-fuchsia-500 text-white p-6 rounded-xl shadow-md font-bold text-center transition-all duration-200 ease-in-out hover:-translate-y-1 hover:shadow-lg active:translate-y-0 active:shadow-md">Forgiveness</button>
                <button data-emotion="guidance" class="verse-card bg-slate-500 text-white p-6 rounded-xl shadow-md font-bold text-center transition-all duration-200 ease-in-out hover:-translate-y-1 hover:shadow-lg active:translate-y-0 active:shadow-md">Guidance</button>
            </div>
            <div id="random-verse-container" class="mt-4">
                 <button id="random-verse-button" class="w-full bg-gray-300 text-gray-800 p-3 rounded-lg hover:bg-gray-400 transition-colors duration-300 font-bold shadow-md">Get a Random Verse</button>
            </div>
            <div id="verse-result" class="mt-4 p-6 bg-gray-100 rounded-2xl shadow-md space-y-2 hidden">
                <p id="result-text" class="text-gray-800 text-lg italic"></p>
                <p id="result-reference" class="text-gray-500 text-sm font-semibold text-right"></p>
                <div class="flex flex-col sm:flex-row justify-between items-center pt-2 space-y-2 sm:space-y-0 sm:space-x-2">
                    <div class="flex items-center space-x-2">
                        <button id="save-verse-button" class="text-gray-500 hover:text-red-500 transition-colors duration-300 font-semibold text-sm flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                            </svg>
                            Add to Favorites
                        </button>
                    </div>
                    <a id="bible-link" href="#" target="_blank" class="text-blue-600 hover:underline text-sm font-semibold">Read on Bible Gateway</a>
                </div>
                <div id="status-message" class="text-xs text-center text-gray-500 opacity-0 transition-opacity duration-300"></div>
            </div>
        </section>

        <!-- My Favorites Section -->
        <section id="favorites-section" class="border-t border-gray-300 pt-6 space-y-4 hidden">
            <h2 class="text-xl font-bold text-gray-800">My Favorite Verses</h2>
            <div id="favorites-list" class="space-y-4">
                <!-- Favorite verses will be dynamically added here -->
            </div>
            <div id="no-favorites-message" class="text-center text-gray-500 italic hidden">
                You haven't saved any favorite verses yet.
            </div>
        </section>

        <!-- Theme and Font Size Controls -->
        <section class="border-t border-gray-300 pt-6 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <span class="text-gray-800 font-semibold">Font Size:</span>
                <div class="flex items-center space-x-2">
                    <button id="font-decrease" class="p-2 w-8 h-8 flex justify-center items-center text-gray-500 rounded-full border border-gray-300 hover:bg-gray-200 transition-colors duration-300">-</button>
                    <button id="font-increase" class="p-2 w-8 h-8 flex justify-center items-center text-gray-500 rounded-full border border-gray-300 hover:bg-gray-200 transition-colors duration-300">+</button>
                </div>
            </div>
            <div class="flex flex-col items-end space-y-2" id="theme-controls">
                <span class="text-gray-800 font-semibold">Themes:</span>
                <div class="flex space-x-2">
                    <button data-theme="light" class="w-8 h-8 rounded-full bg-white border border-gray-300 hover:ring-2 hover:ring-blue-500 transition-all"></button>
                    <button data-theme="dark" class="w-8 h-8 rounded-full bg-gray-800 border border-gray-300 hover:ring-2 hover:ring-blue-500 transition-all"></button>
                    <button data-theme="ocean" class="w-8 h-8 rounded-full bg-blue-300 border border-gray-300 hover:ring-2 hover:ring-blue-500 transition-all"></button>
                    <button data-theme="forest-green" class="w-8 h-8 rounded-full bg-green-500 border border-gray-300 hover:ring-2 hover:ring-green-700 transition-all"></button>
                    <button data-theme="dusk" class="w-8 h-8 rounded-full bg-gray-700 border border-gray-300 hover:ring-2 hover:ring-blue-500 transition-all"></button>
                </div>
            </div>
        </section>
    </div>
    
    <script type="module">
        // Import the Firebase SDK modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, onSnapshot, query, where, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Set Firebase debug logging for development
        setLogLevel('debug');

        // UI element references
        const mainContainer = document.getElementById('main-container');
        const verseOfDayText = document.getElementById('votd-text');
        const verseOfDayReference = document.getElementById('votd-reference');
        const verseResultContainer = document.getElementById('verse-result');
        const resultText = document.getElementById('result-text');
        const resultReference = document.getElementById('result-reference');
        const bibleLink = document.getElementById('bible-link');
        const themeControls = document.getElementById('theme-controls');
        const body = document.body;
        const fontIncreaseButton = document.getElementById('font-increase');
        const fontDecreaseButton = document.getElementById('font-decrease');
        const randomVerseButton = document.getElementById('random-verse-button');
        const saveVerseButton = document.getElementById('save-verse-button');
        const statusMessage = document.getElementById('status-message');
        const favoritesList = document.getElementById('favorites-list');
        const favoritesSection = document.getElementById('favorites-section');
        const noFavoritesMessage = document.getElementById('no-favorites-message');
        const userIdDisplay = document.getElementById('user-id-display');
        
        const THEMES = ['light', 'dark', 'ocean', 'forest-green', 'dusk'];

        // Verses data (for demonstration purposes, a full Bible would be fetched from a service)
        const verses = {
            joy: { text: "The Lord is my strength and my shield; in Him my heart trusts, and I am helped; my heart exults, and with my song I give thanks to Him.", reference: "Psalm 28:7" },
            peace: { text: "Peace I leave with you; my peace I give you. I do not give to you as the world gives. Do not let your hearts be troubled and do not be afraid.", reference: "John 14:27" },
            sadness: { text: "The Lord is close to the brokenhearted and saves those who are crushed in spirit.", reference: "Psalm 34:18" },
            fear: { text: "For God has not given us a spirit of fear, but of power and of love and of a sound mind.", reference: "2 Timothy 1:7" },
            anger: { text: "A fool gives full vent to his anger, but a wise man keeps himself under control.", reference: "Proverbs 29:11" },
            strength: { text: "I can do all things through him who strengthens me.", reference: "Philippians 4:13" },
            hope: { text: "May the God of hope fill you with all joy and peace as you trust in him, so that you may overflow with hope by the power of the Holy Spirit.", reference: "Romans 15:13" },
            gratitude: { text: "Give thanks in all circumstances; for this is God’s will for you in Christ Jesus.", reference: "1 Thessalonians 5:18" },
            healing: { text: "Heal me, O Lord, and I shall be healed; save me, and I shall be saved, for you are my praise.", reference: "Jeremiah 17:14" },
            patience: { text: "Be joyful in hope, patient in affliction, faithful in prayer.", reference: "Romans 12:12" },
            forgiveness: { text: "Bear with each other and forgive one another if any of you has a grievance against someone. Forgive as the Lord forgave you.", reference: "Colossians 3:13" },
            guidance: { text: "Trust in the Lord with all your heart and lean not on your own understanding; in all your ways submit to him, and he will make your paths straight.", reference: "Proverbs 3:5-6" }
        };

        // Firebase variables and initialization
        let db;
        let auth;
        let userId = '';
        
        // Use the global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // Initialize Firebase app and services
        const app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        auth = getAuth(app);
        
        // Authentication state listener
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
                userIdDisplay.textContent = `User ID: ${userId}`;
                console.log('User signed in with UID:', userId);
                // Start listening for real-time favorite verse updates
                setupFavoritesListener();
            } else {
                console.log('No user signed in. Attempting to sign in...');
                // Sign in with custom token or anonymously if not available
                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                        console.log('Signed in with custom token.');
                    } else {
                        await signInAnonymously(auth);
                        console.log('Signed in anonymously.');
                    }
                } catch (error) {
                    console.error('Firebase auth error:', error);
                }
            }
        });

        // Theme management
        const applyTheme = (themeName) => {
            body.classList.remove(...THEMES.map(t => `theme-${t}`));
            body.classList.add(`theme-${themeName}`);
            body.dataset.theme = themeName;
        };

        // Display a verse with a fade-in animation and scroll to it
        const displayVerse = (verse) => {
            resultText.textContent = `“${verse.text}”`;
            resultReference.textContent = `— ${verse.reference}`;
            bibleLink.href = `https://www.biblegateway.com/passage/?search=${encodeURIComponent(verse.reference)}&version=NIV`;
            
            // Show and animate the verse container
            verseResultContainer.classList.remove('hidden');
            verseResultContainer.classList.remove('fade-in'); // Reset animation
            void verseResultContainer.offsetWidth; // Trigger reflow
            verseResultContainer.classList.add('fade-in');
            
            // Smoothly scroll to the verse
            verseResultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        };

        // Display a verse that changes every hour
        const displayVerseOfTheHour = () => {
            const keys = Object.keys(verses);
            const hour = new Date().getHours();
            // Use the hour to get a predictable index that changes every hour
            const index = hour % keys.length;
            const selectedKey = keys[index];
            const verse = verses[selectedKey];
            verseOfDayText.textContent = `“${verse.text}”`;
            verseOfDayReference.textContent = `— ${verse.reference}`;
        };

        // Fetch a random verse
        const getRandomVerse = () => {
            const keys = Object.keys(verses);
            const randomKey = keys[Math.floor(Math.random() * keys.length)];
            const verse = verses[randomKey];
            displayVerse(verse);
        };
        
        // Save a verse to Firestore
        const saveVerse = async (verse) => {
            if (!userId) {
                showStatusMessage('Please wait while we set up your session.', 'text-red-500');
                return;
            }
            try {
                // Check if the verse already exists to prevent duplicates
                const favoritesRef = collection(db, 'artifacts', appId, 'users', userId, 'favorites');
                const q = query(favoritesRef, where("text", "==", verse.text), where("reference", "==", verse.reference));
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    const docRef = await addDoc(favoritesRef, verse);
                    console.log("Document written with ID: ", docRef.id);
                    showStatusMessage('Verse added to your favorites!', 'text-green-500');
                } else {
                    showStatusMessage('This verse is already in your favorites.', 'text-yellow-500');
                }
            } catch (e) {
                console.error("Error adding document: ", e);
                showStatusMessage('Failed to save verse. Please try again.', 'text-red-500');
            }
        };

        // Delete a favorite verse from Firestore
        const deleteVerse = async (docId) => {
            if (!userId) return;
            try {
                const verseDocRef = doc(db, 'artifacts', appId, 'users', userId, 'favorites', docId);
                await deleteDoc(verseDocRef);
                console.log("Document successfully deleted!");
                showStatusMessage('Verse removed from your favorites.', 'text-green-500');
            } catch (e) {
                console.error("Error removing document: ", e);
                showStatusMessage('Failed to delete verse.', 'text-red-500');
            }
        };

        // Listen for real-time updates on the user's favorites collection
        const setupFavoritesListener = () => {
            if (!userId) return;
            const favoritesRef = collection(db, 'artifacts', appId, 'users', userId, 'favorites');
            
            onSnapshot(favoritesRef, (snapshot) => {
                const favorites = [];
                snapshot.forEach(doc => {
                    favorites.push({ id: doc.id, ...doc.data() });
                });
                renderFavorites(favorites);
            }, (error) => {
                console.error("Error listening to favorites: ", error);
            });
        };

        // Render the list of favorite verses
        const renderFavorites = (favorites) => {
            favoritesList.innerHTML = ''; // Clear the current list
            if (favorites.length === 0) {
                noFavoritesMessage.classList.remove('hidden');
                favoritesSection.classList.add('hidden');
            } else {
                noFavoritesMessage.classList.add('hidden');
                favoritesSection.classList.remove('hidden');
                favorites.forEach(verse => {
                    const favoriteCard = document.createElement('div');
                    favoriteCard.id = verse.id;
                    favoriteCard.className = 'p-4 bg-gray-100 rounded-lg shadow-md space-y-2 relative fade-in group transition-transform duration-300 transform-gpu hover:scale-105';
                    favoriteCard.innerHTML = `
                        <p class="text-gray-800 italic">“${verse.text}”</p>
                        <p class="text-gray-500 text-sm font-semibold text-right">— ${verse.reference}</p>
                        <button class="absolute top-2 right-2 text-gray-400 hover:text-red-500 transition-colors duration-200 opacity-0 group-hover:opacity-100" data-doc-id="${verse.id}" aria-label="Remove from favorites">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 112 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    `;
                    favoritesList.appendChild(favoriteCard);

                    // Add event listener to the remove button
                    const deleteButton = favoriteCard.querySelector('button');
                    deleteButton.addEventListener('click', () => deleteVerse(deleteButton.dataset.docId));
                });
            }
        };
        
        // Show a temporary status message
        const showStatusMessage = (message, colorClass) => {
            statusMessage.textContent = message;
            statusMessage.className = `text-xs text-center transition-opacity duration-300 ${colorClass}`;
            statusMessage.style.opacity = 1;
            setTimeout(() => {
                statusMessage.style.opacity = 0;
            }, 3000);
        };
        
        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Add pop-in animation to main container
            mainContainer.classList.add('pop-in');
            displayVerseOfTheHour();
            
            // Set initial theme from local storage or default to light
            const savedTheme = localStorage.getItem('theme') || 'light';
            applyTheme(savedTheme);

            // Set initial font size
            const savedFontSize = parseInt(localStorage.getItem('fontSize')) || 16;
            document.documentElement.style.fontSize = `${savedFontSize}px`;

            // Load saved theme
            const currentThemeButton = document.querySelector(`[data-theme="${savedTheme}"]`);
            if (currentThemeButton) {
                currentThemeButton.classList.add('ring-2', 'ring-blue-500');
            }
        });

        // Click handler for all emotion buttons
        document.querySelectorAll('.verse-card').forEach(button => {
            button.addEventListener('click', () => {
                const emotion = button.dataset.emotion;
                if (verses[emotion]) {
                    displayVerse(verses[emotion]);
                }
            });
        });

        randomVerseButton.addEventListener('click', getRandomVerse);
        saveVerseButton.addEventListener('click', () => {
            const verseText = resultText.textContent.replace(/^“|”$/g, '');
            const verseReference = resultReference.textContent.replace(/^—\s*/, '');
            if (verseText && verseReference) {
                saveVerse({
                    text: verseText,
                    reference: verseReference
                });
            }
        });

        themeControls.addEventListener('click', (event) => {
            const themeButton = event.target.closest('[data-theme]');
            if (themeButton) {
                const themeName = themeButton.dataset.theme;
                applyTheme(themeName);
                localStorage.setItem('theme', themeName);
                document.querySelectorAll('[data-theme]').forEach(btn => {
                    btn.classList.remove('ring-2', 'ring-blue-500', 'ring-green-700');
                });
                if (themeName === 'forest-green') {
                    themeButton.classList.add('ring-2', 'ring-green-700');
                } else {
                    themeButton.classList.add('ring-2', 'ring-blue-500');
                }
            }
        });
        
        fontIncreaseButton.addEventListener('click', () => {
            let currentSize = parseInt(document.documentElement.style.fontSize) || 16;
            if (currentSize < 24) {
                currentSize += 2;
                document.documentElement.style.fontSize = `${currentSize}px`;
                localStorage.setItem('fontSize', currentSize);
            }
        });

        fontDecreaseButton.addEventListener('click', () => {
            let currentSize = parseInt(document.documentElement.style.fontSize) || 16;
            if (currentSize > 12) {
                currentSize -= 2;
                document.documentElement.style.fontSize = `${currentSize}px`;
                localStorage.setItem('fontSize', currentSize);
            }
        });
    </script>
</body>
</html>
